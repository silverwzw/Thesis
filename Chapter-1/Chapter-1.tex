\chapter{Introduction}
\label{chap:intro}

    Mention ``file system'' and what usually comes to mind are disk file systems like FAT32~\cite{fat_wiki} or Ext4~\cite{ext4}, for disks are the most common persistent storage. In addition, file systems can be used to access data from remote machine for example NFS~\cite{nfs}, can be used to access non-traditional form of data and storage spaces for instance GmailFS~\cite{gmailfs, gmailfs2}, can also provide useful and transparent functionalities like encryption, compression or soft-RAID~\cite{encrypt, compression}.

    As the network bandwidth increases, we no longer have to keep our data on local disk. Nowadays more and more data are stored online. Individuals are uploading their personal data to web services; commercial companies are using cloud storage systems like Amazon S3 to store their data remotely. There are a large number of reasons to store data in the cloud. It makes sharing and collaboration easier and ensures that the data can be accessed by its owner anywhere and anytime. Though there are lots of services and applications that help us to access data online, a network file system is able to make this process totally transparent to the user and user programs. A distributed file system can also maps different machines into a logically unified volume while providing features like redundancy and load balancing. Popular distributed file systems adopted by industry and academic institutes include NFS and AFS~\cite{afs}.

    NoSQL databases~\cite{nosql} are used for store and retrieve data which is modeled differently from the tabular relations. They provide alternatives to classic relational databases, bring innovation and new ideas to the community, industry and academia. Commercial companies like Google and Amazon have been using them in production environments for many years. Compared to relational databases, they have many advantages in performance, scalability and flexibility whereas low functionality, e.g. not normalized data and poor transaction support~\cite{transaction}, is their disadvantage.

    We believe a document oriented NoSQL database~\cite{docdb} can serve as a backend of the file system to store and manage the actual data. Because a file system needs to ensure consistency and query single entity (file, directory) but not much demand of join queries and join updates. A document oriented NoSQL database that focuses on performance, scalability and flexibility rather than the relational algebra may be a better fit to this task. In addition, the high scalability of NoSQL database makes it easy to distribute the storage on to different machine~\cite{sharding}.

    Furthermore, when the file system is released from the burden of on disk resource management by using a database as backend, developers can put more efforts toward other features of the file system such as snapshot and deduplication. A snapshot subsystem is useful. It can be used to test installations, keep track of modifications, provide a rollback mechanism, and make the backup process more efficient. It is becoming more and more popular for a modern file system to have the capability to take snapshots. For instance, from FAT to NTFS~\cite{ntfs} and from Ext2~\cite{ext2_wiki} to Ext4, more and more file systems have this feature built-in. Ground breaking file system ZFS~\cite{zfs_wiki} and experimental file system BTRFS~\cite{btrfs} all come with snapshot capability. Deduplication is another popular feature, where the file system try to identify duplicated data and eliminate them in order to save storage space.

\section{Contribution}

    We design a new distributed snapshot file system and study the way to improve its performance. We use MongoDB as a backend of the file system to improve the network performance and reliability. We introduce rsync algorithm into the file system and use it to improve the network performance and snapshot efficiency, by identifying the duplicated data between remote and local and between snapshots. In addition, we use a new design of snapshot system which is called patch-based snapshot. 

    We vaildate our design by implemenating it and testing it. The test results indicate that the file system we proposed has a comparable performance to the popular network file system NFS. Furthermore, it shows that the rsync enhanced copy-on-write snapshot system can boost the space efficiency of the snapshot system compared to classic copy-on-write snapshot system.

    In this thesis, we propose a new design of distributed file system with snapshot capability. We have the design implemented by Java, MongoDB, FUSE, and other techniques. We also propose several new ways to improve the efficiency of the file system. We tested and compared the performance of our implantation with other file systems, studied the snapshot system performance under different scenarios, compare and explain the outcome of tests.
