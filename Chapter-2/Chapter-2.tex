\chapter{Related work}
\label{chap:related_work}

    There are important prior work in customized file systems, NoSQL database, and snapshots. Several of them are related to this thesis and they are summarized in this chapter.

\section{POSIX}

    POSIX (Portable Operating System Interface), is a family of IEEE standard for operating systems~\cite{posix_wiki}. It influences the design of many modern operating system (e.g., Linux, Windows NT, Mac). The POSIX standard defines a standard environment for operating system (process, user, file, directory, etc.) along with a set of APIs for user program (like fork, exec, I/O functions, etc.)~\cite{posix}. Some file format standard (e.g., tar) and some shell utilities (e.g. awk, vi) are also included in the standard. The purpose of this standard is to maintain compatibility between operating system such that a user program written for one POSIX operating system will work on any POSIX operating system theoretically. 

    The POSIX standard specifies a set of file system APIs that defines file and directory operations. Any file system that implements this set of APIs should be compatible with operating systems that follows POSIX standard.

\section{FUSE}

    FUSE, the Filesystem in User Space, is a developer framework for file system. It was originally developed for AVFS (virtual file system that allows all users
to look inside archived or compressed files, or access remote files)~\cite{avfs} but has become a separate project. It has now been adopted into the Linux kernel and has many ports on other Unix-like operating systems. FUSE provides a programming interface that is very similar to POSIX file operations. A file system with this interface can get file system call from kernel module VFS. Such that a user programs is able to use standard file system call to access it as if the file system is supported by operating system natively. By running the file system in user space, FUSE isolates the file system from operating system. In such a way, developers of the file system do not need to understand complicated kernel code or to debug in the kernel~\cite{fuse}.

    FUSE routes the file system call from VFS in kernel space back to the user space and then lets the user program to process the file system call. It is a widely used component of Linux file system. A number of well-known projects are using FUSE, for example the OverlayFS, ntfs-3g, and vmware tools. Inspired by FUSE, there are some other user space file system like Dokan under windows.

    There are different language bindings of FUSE. Our implementation is built on the Java bindings FUSE-JNA. The FUSE-JNA is a recent active project developed by Etienne Perot. It describes itself as ``No-nonsense, actually-working Java bindings to FUSE using JNA''~\cite{fusejna}. Other Java binding of FUSE include FUSE-J, jnetfs~\cite{jnetfs}.

\section{MongoDB}

    MongoDB is a document oriented NoSQL distributed database~\cite{mongo_overview}. It focuses on scalability, performance and availability~\cite{mongo_overview}. Document oriented storage that can store semi-structured data makes it flexible and makes it suitable for agile development~\cite{docdb}. In addition, MongoDB also provides features like load balancing and replication. These features make MongoDB an ideal backend for a distributed file system. Developers have already built a file storage system called GridFS using MongoDB which provides a mechanism to store and retrieve file of any size~\cite{gridfs}.

    MongoDB represents document in JSON (JavaScript Object Notation) format. JSON is a open, human and machine-readable standard that facilitates data interchange. Behind the scenes, MongoDB uses BSON (Binary JSON) to encode and store the documents. Both JSON and BSON format supports embedding object and arrays within other objects and arrays. MongoDB can query and build index not only on top level keys but also nested objects. The developer believes this will grant users of MongoDB ease of use and flexibility together with the speed and richness of a lightweight binary format~\cite{bson}.

    MongoDB is one of the most popular NoSQL database. It has a large and active developer community. A recent \$150 million investment ensures the long term support and reflects the confidence of investors.

\section{Snapshot}

    A snapshot is a state of a system at a particular point in timer~\cite{btrfscow}. They can be either read-only or writable. Writable snapshots are also called clones. They are supported by several advanced file system like ZFS and BTRFS. The Ext4 file system also has a development branch for writable snapshot. From the userâ€™s point of view, a read-only snapshot is an immutable and exact copy of the file system at a specific time, whereas a writable snapshot is a fork of the file system at a particular time spot. A writable snapshot allows modification to snapshots but modifications to a snapshot are separate from the origin and other snapshots. (i.e., changes to the snapshot cannot be seen in other snapshots or the origin and vice versa) With the help of writable snapshot, one can easily create and switch between different file system branch and make changes to them without affecting other branch. Writable snapshots can also provide file system isolation for process, software or virtual machine.

\section{Copy-on-Write}

    Copy-on-write is a strategy widely used in computer science. A program that uses copy-on-write strategy accesses data though a pointer or a reference. When a copy operation is requested, instead of making a copy of actual data, a program that uses copy-on-write strategy will simply return a new reference to the original data. Only when a modification to one of the ``copies'' is requested, the program will then make a actual copy of the original data and then apply the modification to that copy. At the end, the program will point corresponding pointer or reference to the updated copy. This design not only eliminates unnecessary overhead in data copy but also ensures consistency, integrity and an easy support of transactions. In addition to those benefits, a file system using copy-on-write strategy will be able to take snapshots with low overhead. Without copy-on-write strategy, snapshots either write in-place which is more expensive, or requires special architecture in storage system like the Split-Mirror architecture.

\section{Existing Snapshot Storage Systems}

    Snapshot is an important features of a storage system. Existing works include LVM snapshot, SnapFS, OverlayFS, ZFS, BTRFS, and Ext4.
    
    The LVM snapshot is a snapshot system included in the logical volume manager~\cite{lvm, disk_perform_lvm}. It takes snapshot of blocks in the logical volume and gives snapshots capability to any file system build upon the LVM system. However, as an underlying service, LVM snapshot is not aware of file structures, making it hard to find duplicate data stream and thus is less efficient in terms of disk space.
    
    SnapFS is a file system focusing on snapshots in Linux kernel~\cite{snapfs}. It is strongly coupled with its underlying Ext file system. Therefore, SnapFS is able to apply copy-on-write strategy on block but restrict its underlying file system to Ext file system family. 
    
    OverlayFS~\cite{overlayfs}, also called UnionFS, is a file system popular in embedded systems, hand held devices, PDAs and smartphones. Similar to SnapFS, OverlayFS is also built upon other file systems. But OverlayFS does not restrict the type of its underlying file system as SnapFS does. This gives OverlayFS a lot flexibility as it can adapt to any storage media that has a standard file system implemented. The OverlayFS applies copy-on-write on files and directory level.

    BTRFS~\cite{btrfs} is an experimental file system developed by Oracle. It is inspired by the well-known Solaris file system ZFS and shares a lot of similarity with ZFS. Both of them usese copy-on-write snapshots at block level granularity~\cite{btrfscow}.
    
    Ext4 file system was extends to include a snapshot subsystem that applies copy-on-write strategy on block level. A writable snapshot feature for Ext4 is currently under development by the same group of developer~\cite{ext4snap}. It is inspired by CTERA Network's NEXT3 file system which is a clone of ext3 file system with built-in support for snapshots.

\section{The Rsync Algorithm}
    
    The rsync algorithm is used in the rsync utility in Unix-like system to synchronize files though network. This algorithm is invented by Andrew Tridgell and he described the algorithm as ``for the efficient update of data over a high latency and low bandwidth link''~\cite{rsync_alg}. The algorithm calculate and compare a weak checksum of blocks between remote file and local file to identify duplicated blocks. In order to achieve efficiency, the checksum algorithm takes only O(1) time complexity to calculate based on prior results, such that checking duplication at any offset in local file is possible. The algorithm performs well in delta encoding and reduces the data transferred between remote machines.

